#
# VARIABLES
#
# The following variables influence the deployment and configuration of etcd:
#   etcd_cluster_name - The name of the etcd cluster, which influences the location and
#                       names of the private keys and certificates for the cluster.
#
# The following variables influence the deployment and configuration of Kubernetes:
#   k8s_cluster_name  - The name of the etcd cluster, which influences the location and
#                       names of the private keys and certificates for the cluster.
#   k8s_etcd_topology - The etcd topology for the Kubernetes cluster, which can be stacked
#                       or external, for an external etcd cluster.
#
#
# PROFILES
#
# Profiles are used to group a related set of hosts that need to be provisioned together,
# e.g., the hosts that form part of an etcd cluster, the hosts that form part of a
# Kubernetes cluster, the hosts that suport a set of integrated development tools, etc.
#

variables:
# ----------------------------------------------------------------------------------------
# Etcd Configuration
# ----------------------------------------------------------------------------------------
- name: etcd_cluster_name
  values:
  - local

# ----------------------------------------------------------------------------------------
# Kubernetes Configuration
# ----------------------------------------------------------------------------------------
- name: containerd_centos_package
  values:
  - containerd.io-1.2.13-3.1.el7.x86_64.rpm 
- name: containerd_centos_package_version
  values:
  - 1.2.13
- name: docker_ce_centos_package
  values:
  - docker-ce-19.03.8-3.el7.x86_64.rpm
- name: docker_ce_centos_package_version
  values:
  - 19.03.8
- name: docker_ce_cli_centos_package
  values:
  - docker-ce-cli-19.03.8-3.el7.x86_64.rpm 
- name: docker_ce_cli_centos_package_version
  values:
  - 19.03.8
- name: docker_ce_ubuntu_package_version
  values:
  - 5:19.03.6~3-0~ubuntu-bionic
- name: helm_version
  values:
  - 3.1.2
- name: helm_package_checksum
  values:
  - sha256:e6be589df85076108c33e12e60cfb85dcd82c5d756a6f6ebc8de0ee505c9fd4c
- name: k8s_etcd_topology
  values:
  - stacked
- name: k8s_cluster_name
  values:
  - local
- name: k8s_cluster_domain
  values:
  - local.internal
- name: k8s_control_plane_endpoint
  values:
  - k8s-local-api.local
- name: k8s_service_subnet
  values:
  - 10.254.0.0/16
- name: k8s_pod_subnet
  values:
  - 10.255.0.0/16
- name: k8s_cni_provider
  values:
  - weave
- name: k8s_centos_package_version
  values:
  - 1.17.5
- name: k8s_ubuntu_package_version
  values:
  - 1.17.5-00

# ----------------------------------------------------------------------------------------
# Kubernetes Storage Configuration
# ----------------------------------------------------------------------------------------
- name: longhorn_enabled
  values:
  - true
- name: topolvm_enabled
  values:
  - true
- name: topolvm_version
  values:
  - 0.4.1
- name: topolvm_lvmd_version
  values:
  - 0.4.1
- name: topolvm_volume_group
  values:
  - system

# ----------------------------------------------------------------------------------------
# Kubernetes Extensions Configuration
# ----------------------------------------------------------------------------------------
- name: bitnami_labs_sealed_secrets_enabled
  values:
  - true
- name: bitnami_labs_sealed_secrets_helm_chart_version
  values:
  - 1.8.0
- name: bitnami_labs_sealed_secrets_kubeseal_version
  values:
  - 0.10.0

# ----------------------------------------------------------------------------------------
# Kubernetes Operator Configuration
# ----------------------------------------------------------------------------------------
- name: operator_lifecycle_manager_enabled
  values:
  - false
- name: postgres_operator_enabled
  values:
  - true
- name: postgres_operator_helm_chart_version
  values:
  - 1.5.0
- name: postgres_operator_ui_enabled
  values:
  - true
- name: postgres_operator_ui_helm_chart_version
  values:
  - 1.5.0

# ----------------------------------------------------------------------------------------
# Istio Configuration
# ----------------------------------------------------------------------------------------
- name: istio_enabled
  values:
  - true
- name: istio_grafana_enabled
  values:
  - false
- name: istio_kiali_enabled
  values:
  - true
- name: istio_package_checksum
  values:
  - sha256:0e32ac8af40b9edcb49a31b8f45df4f3a825a47fd2aa1ac114e93def73dc3c17
- name: istio_prometheus_enabled
  values:
  - false
- name: istio_tracing_enabled
  values:
  - false
- name: istio_version
  values:
  - 1.5.2
- name: istioctl_package_checksum
  values:
  - sha256:756956f182bdd15c92b218fd9de4b3f75486a13535d13288fae9024181afd71a

# ----------------------------------------------------------------------------------------
# External Monitoring Configuration
# ----------------------------------------------------------------------------------------
- name: prometheus_data_directory
  values:
  - /var/lib/prometheus

# ----------------------------------------------------------------------------------------
# Monitoring Configuration (Kubernetes-based)
#
# Where elasticsearch_cluster_type is one of single, minimal or full.
#
# ----------------------------------------------------------------------------------------
- name: monitoring_enabled
  values:
  - true
- name: monitoring_elasticsearch_cluster_type
  values:
  - standalone
- name: monitoring_elasticsearch_enabled
  values:
  - true
- name: monitoring_elasticsearch_helm_chart_version
  values:
  - 7.6.2
- name: monitoring_elasticsearch_persistent_volume_size
  values:
  - 10Gi
- name: monitoring_elasticsearch_persistent_volume_storage_class_name
  values:
  - default-local-storage
- name: monitoring_grafana_enabled
  values:
  - true
- name: monitoring_grafana_helm_chart_version
  values:
  - 5.0.13
- name: monitoring_jaeger_enabled
  values:
  - true
- name: monitoring_jaeger_helm_chart_version
  values:
  - 0.28.0
- name: monitoring_kibana_enabled
  values:
  - true
- name: monitoring_kibana_helm_chart_version
  values:
  - 7.6.2
- name: monitoring_prometheus_enabled
  values:
  - true
- name: monitoring_prometheus_helm_chart_version
  values:
  - 11.1.2
- name: monitoring_prometheus_persistent_volume_storage_class_name
  values:
  - default-local-storage
- name: monitoring_prometheus_alert_manager_persistent_volume_size
  values:
  - 2Gi
- name: monitoring_prometheus_server_persistent_volume_size
  values:
  - 10Gi

# ----------------------------------------------------------------------------------------
# Monitoring Configuration (External)
# ----------------------------------------------------------------------------------------
- name: grafana_centos_package
  values:
  - grafana-6.7.3-1.x86_64.rpm
- name: grafana_centos_package_checksum
  values:
  - sha256:fbe7eff6b5a6786c9affd5917fce53e24f16c395178352768b96935a62499211
- name: grafana_centos_package_version
  values:
  - 6.7.3
- name: grafana_ubuntu_package
  values:
  - grafana_6.7.3_amd64.deb
- name: grafana_ubuntu_package_checksum
  values:
  - sha256:1ffa1329cb0f574f0f60c3f57116b2a3d68b3db0a39eca9099956e9a349dc8e6  
- name: grafana_ubuntu_package_version
  values:
  - 6.7.3
- name: prometheus_node_exporter_version
  values:
  - 1.0.0-rc.0
- name: prometheus_node_exporter_package_checksum
  values:
  - sha256:f175cffc4b96114e336288c9ea54b54abe793ae6fcbec771c81733ebc2d7be7c
- name: prometheus_version
  values:
  - 2.18.1
- name: prometheus_package_checksum
  values:
  - sha256:5fcc35b78bd0a1b84afae6de94248a4bea3cdb4daf0d54a37b5491cb86b014d7

profiles:
- name: devops
  hosts:
  - devops.local

- name: etcd-cluster
  hosts:
  - etcd-local-01.local
  - etcd-local-02.local
  - etcd-local-03.local

- name: k8s-minimal
  hosts:
  - k8s-local-api.local
  - k8s-local-m-01.local
  - k8s-local-w-01.local

- name: k8s-only-masters
  hosts:
  - k8s-local-api.local
  - k8s-local-m-01.local
  - k8s-local-m-02.local
  - k8s-local-m-03.local

- name: k8s-full
  hosts:
  - k8s-local-api.local
  - k8s-local-m-01.local
  - k8s-local-m-02.local
  - k8s-local-m-03.local
  - k8s-local-w-01.local
  - k8s-local-w-02.local
  - k8s-local-w-03.local

- name: test-all
  hosts:
  - test-centos7.local
  - test-centos8.local
  - test-centos81.local  
  - test-ubuntu1804.local
  - test-ubuntu2004.local  

- name: test-centos7
  hosts:
  - test-centos7.local

- name: test-centos7
  hosts:
  - test-centos7.local

- name: test-centos8
  hosts:
  - test-centos8.local

- name: test-centos81
  hosts:
  - test-centos81.local
  
- name: test-ubuntu1804
  hosts:
  - test-ubuntu1804.local
  
- name: test-ubuntu2004
  hosts:
  - test-ubuntu2004.local


hosts:
- name:               devops.local
  domain:             local
  type:               centos7
  ansible_playbook:   ansible/devops.yaml
  ansible_groups:     k8s_master
  virtualbox:
    cpus:             4
    memory:           6144
    fqdn:             devops.local
    domain:           local
    ip:               192.168.184.60/24
    gateway:          192.168.184.2
    dns_server:       192.168.184.2
  vmware_desktop:
    cpus:             4
    memory:           6144
    fqdn:             devops.local
    domain:           local
    ip:               192.168.184.60/24
    gateway:          192.168.184.2
    dns_server:       192.168.184.2
  vmware_esxi:
    cpus:             4
    memory:           6144
    fqdn:             devops.local
    domain:           local
    ip:               192.168.0.60/24
    gateway:          192.168.0.1
    dns_server:       192.168.0.1

- name:               etcd-local-01.local
  type:               ubuntu1804
  ansible_playbook:   ansible/devops.yaml
  ansible_groups:     monitored,etcd
  virtualbox:
    cpus:             1
    memory:           512
    fqdn:             etcd-local-01.local
    domain:           local
    ip:               192.168.184.41/24
    gateway:          192.168.184.2
    dns_server:       192.168.184.2
  vmware_desktop:
    cpus:             1
    memory:           512
    fqdn:             etcd-local-01.local
    domain:           local
    ip:               192.168.184.41/24
    gateway:          192.168.184.2
    dns_server:       192.168.184.2
  vmware_esxi:
    cpus:             1
    memory:           512
    fqdn:             etcd-local-01.local
    domain:           local
    ip:               192.168.0.41/24
    gateway:          192.168.0.1
    dns_server:       192.168.0.1

- name:               etcd-local-02.local
  type:               ubuntu1804
  ansible_playbook:   ansible/devops.yaml
  ansible_groups:     monitored,etcd
  virtualbox:
    cpus:             1
    memory:           512
    fqdn:             etcd-local-02.local
    domain:           local
    ip:               192.168.184.42/24
    gateway:          192.168.184.2
    dns_server:       192.168.184.2
  vmware_desktop:
    cpus:             1
    memory:           512
    fqdn:             etcd-local-02.local
    domain:           local
    ip:               192.168.184.42/24
    gateway:          192.168.184.2
    dns_server:       192.168.184.2
  vmware_esxi:
    cpus:             1
    memory:           512
    fqdn:             etcd-local-02.local
    domain:           local
    ip:               192.168.0.42/24
    gateway:          192.168.0.1
    dns_server:       192.168.0.1

- name:               etcd-local-03.local
  domain:             local
  type:               ubuntu1804
  ansible_playbook:   ansible/devops.yaml
  ansible_groups:     monitored,etcd
  virtualbox:
    cpus:             1
    memory:           512
    fqdn:             etcd-local-03.local
    domain:           local
    ip:               192.168.184.43/24
    gateway:          192.168.184.2
    dns_server:       192.168.184.2
  vmware_desktop:
    cpus:             1
    memory:           512
    fqdn:             etcd-local-03.local
    domain:           local
    ip:               192.168.184.43/24
    gateway:          192.168.184.2
    dns_server:       192.168.184.2
  vmware_esxi:
    cpus:             1
    memory:           512
    fqdn:             etcd-local-03.local
    domain:           local
    ip:               192.168.0.43/24
    gateway:          192.168.0.1
    dns_server:       192.168.0.1

- name:               k8s-local-api.local
  domain:             local
  type:               ubuntu1804
  ansible_playbook:   ansible/devops.yaml
  ansible_groups:     k8s_load_balancer
  virtualbox:
    cpus:             1
    memory:           512
    fqdn:             k8s-local-api.local
    domain:           local
    ip:               192.168.184.50/24
    gateway:          192.168.184.2
    dns_server:       192.168.184.2
  vmware_desktop:
    cpus:             1
    memory:           512
    fqdn:             k8s-local-api.local
    domain:           local
    ip:               192.168.184.50/24
    gateway:          192.168.184.2
    dns_server:       192.168.184.2
  vmware_esxi:
    cpus:             1
    memory:           1024
    fqdn:             k8s-local-api.local
    domain:           local
    ip:               192.168.0.50/24
    gateway:          192.168.0.1
    dns_server:       192.168.0.1

- name:               k8s-local-m-01.local
  domain:             local
  type:               ubuntu1804
  ansible_playbook:   ansible/devops.yaml
  ansible_groups:     k8s_master,k8s_components
  virtualbox:
    cpus:             2
    memory:           2048
    fqdn:             k8s-local-m-01.local
    domain:           local
    ip:               192.168.184.51/24
    gateway:          192.168.184.2
    dns_server:       192.168.184.2
  vmware_desktop:
    cpus:             2
    memory:           2048
    fqdn:             k8s-local-m-01.local
    domain:           local
    ip:               192.168.184.51/24
    gateway:          192.168.184.2
    dns_server:       192.168.184.2
  vmware_esxi:
    cpus:             2
    memory:           2048
    fqdn:             k8s-local-m-01.local
    domain:           local
    ip:               192.168.0.51/24
    gateway:          192.168.0.1
    dns_server:       192.168.0.1

- name:               k8s-local-m-02.local
  domain:             local
  type:               ubuntu1804
  ansible_playbook:   ansible/devops.yaml
  ansible_groups:     k8s_master,k8s_components
  virtualbox:
    cpus:             2
    memory:           2048
    fqdn:             k8s-local-m-02.local
    domain:           local
    ip:               192.168.184.52/24
    gateway:          192.168.184.2
    dns_server:       192.168.184.2
  vmware_desktop:
    cpus:             2
    memory:           2048
    fqdn:             k8s-local-m-02.local
    domain:           local
    ip:               192.168.184.52/24
    gateway:          192.168.184.2
    dns_server:       192.168.184.2
  vmware_esxi:
    cpus:             2
    memory:           2048
    fqdn:             k8s-local-m-02.local
    domain:           local
    ip:               192.168.0.52/24
    gateway:          192.168.0.1
    dns_server:       192.168.0.1

- name:               k8s-local-m-03.local
  domain:             local
  type:               ubuntu1804
  ansible_playbook:   ansible/devops.yaml
  ansible_groups:     k8s_master,k8s_components
  virtualbox:
    cpus:             2
    memory:           2048
    fqdn:             k8s-local-m-03.local
    domain:           local
    ip:               192.168.184.53/24
    gateway:          192.168.184.2
    dns_server:       192.168.184.2
  vmware_desktop:
    cpus:             2
    memory:           2048
    fqdn:             k8s-local-m-03.local
    domain:           local
    ip:               192.168.184.53/24
    gateway:          192.168.184.2
    dns_server:       192.168.184.2
  vmware_esxi:
    cpus:             2
    memory:           2048
    fqdn:             k8s-local-m-03.local
    domain:           local
    ip:               192.168.0.53/24
    gateway:          192.168.0.1
    dns_server:       192.168.0.1

- name:               k8s-local-w-01.local
  domain:             local
  type:               ubuntu1804
  ansible_playbook:   ansible/devops.yaml
  ansible_groups:     k8s_worker,k8s_components
  virtualbox:
    cpus:             2
    memory:           5120
    fqdn:             k8s-local-w-01.local
    domain:           local
    ip:               192.168.184.54/24
    gateway:          192.168.184.2
    dns_server:       192.168.184.2
  vmware_desktop:
    cpus:             2
    memory:           5120
    fqdn:             k8s-local-w-01.local
    domain:           local
    ip:               192.168.184.54/24
    gateway:          192.168.184.2
    dns_server:       192.168.184.2
  vmware_esxi:
    cpus:             2
    memory:           5120
    data_disk:        40960
    fqdn:             k8s-local-w-01.local
    domain:           local
    ip:               192.168.0.54/24
    gateway:          192.168.0.1
    dns_server:       192.168.0.1

- name:               k8s-local-w-02.local
  domain:             local
  type:               ubuntu1804
  ansible_playbook:   ansible/devops.yaml
  ansible_groups:     k8s_worker,k8s_components
  virtualbox:
    cpus:             2
    memory:           5120
    fqdn:             k8s-local-w-02.local
    domain:           local
    ip:               192.168.184.55/24
    gateway:          192.168.184.2
    dns_server:       192.168.184.2
  vmware_desktop:
    cpus:             2
    memory:           5120
    fqdn:             k8s-local-w-02.local
    domain:           local
    ip:               192.168.184.55/24
    gateway:          192.168.184.2
    dns_server:       192.168.184.2
  vmware_esxi:
    cpus:             2
    memory:           5120
    data_disk:        40960
    fqdn:             k8s-local-w-02.local
    domain:           local
    ip:               192.168.0.55/24
    gateway:          192.168.0.1
    dns_server:       192.168.0.1

- name:               k8s-local-w-03.local
  domain:             local
  type:               ubuntu1804
  ansible_playbook:   ansible/devops.yaml
  ansible_groups:     k8s_worker,k8s_components
  virtualbox:
    cpus:             2
    memory:           5120
    fqdn:             k8s-local-w-03.local
    domain:           local
    ip:               192.168.184.56/24
    gateway:          192.168.184.2
    dns_server:       192.168.184.2
  vmware_desktop:
    cpus:             2
    memory:           5120
    fqdn:             k8s-local-w-03.local
    domain:           local
    ip:               192.168.184.56/24
    gateway:          192.168.184.2
    dns_server:       192.168.184.2
  vmware_esxi:
    cpus:             2
    memory:           5120
    data_disk:        40960
    fqdn:             k8s-local-w-03.local
    domain:           local
    ip:               192.168.0.56/24
    gateway:          192.168.0.1
    dns_server:       192.168.0.1

- name:               monitor.local
  domain:             local
  type:               ubuntu1804
  ansible_playbook:   ansible/devops.yaml
  ansible_groups:     monitored,prometheus,grafana
  virtualbox:
    cpus:             1
    memory:           1024
    fqdn:             monitor.local
    domain:           local
    ip:               192.168.184.30/24
    gateway:          192.168.184.2
    dns_server:       192.168.184.2
  vmware_desktop:
    cpus:             1
    memory:           1024
    fqdn:             monitor.local
    domain:           local
    ip:               192.168.184.30/24
    gateway:          192.168.184.2
    dns_server:       192.168.184.2
  vmware_esxi:
    cpus:             1
    memory:           1024
    fqdn:             monitor.local
    domain:           local
    ip:               192.168.0.30/24
    gateway:          192.168.0.1
    dns_server:       192.168.0.1

- name:               test-centos7.local
  domain:             local
  type:               centos7
  ansible_playbook:   ansible/devops.yaml
  ansible_groups:     monitored
  virtualbox:
    cpus:             2
    memory:           1024
    data_disk:        4096
    fqdn:             test-centos7.local
    domain:           local
    ip:               192.168.184.49/24
    gateway:          192.168.184.2
    dns_server:       192.168.184.2
  vmware_desktop:
    cpus:             2
    memory:           1024
    data_disk:        4096
    fqdn:             test-centos7.local
    domain:           local
    ip:               192.168.184.49/24
    gateway:          192.168.184.2
    dns_server:       192.168.184.2
  vmware_esxi:
    cpus:             2
    memory:           1024
    #data_disk:        4096
    fqdn:             test-centos7.local
    domain:           local
    ip:               192.168.0.49/24
    gateway:          192.168.0.1
    dns_server:       192.168.0.1

- name:               test-centos8.local
  domain:             local
  type:               centos8
  ansible_playbook:   ansible/devops.yaml
  ansible_groups:     monitored
  virtualbox:
    cpus:             2
    memory:           1024
    data_disk:        4096
    fqdn:             test-centos8.local
    domain:           local
    ip:               192.168.184.48/24
    gateway:          192.168.184.2
    dns_server:       192.168.184.2
  vmware_desktop:
    cpus:             2
    memory:           1024
    data_disk:        4096
    fqdn:             test-centos8.local
    domain:           local
    ip:               192.168.184.48/24
    gateway:          192.168.184.2
    dns_server:       192.168.184.2
  vmware_esxi:
    cpus:             2
    memory:           1024
    data_disk:        4096
    fqdn:             test-centos8.local
    domain:           local
    ip:               192.168.184.48/24
    gateway:          192.168.184.2
    dns_server:       192.168.184.2

- name:               test-ubuntu1804.local
  domain:             local
  type:               ubuntu1804
  ansible_playbook:   ansible/devops.yaml
  ansible_groups:     monitored
  virtualbox:
    cpus:             2
    memory:           1024
    data_disk:        4096
    fqdn:             test-ubuntu1804.local
    domain:           local
    ip:               192.168.184.45/24
    gateway:          192.168.184.1
    dns_server:       192.168.184.1
  vmware_desktop:
    cpus:             2
    memory:           1024
    data_disk:        4096
    fqdn:             test-ubuntu1804.local
    domain:           local
    ip:               192.168.184.45/24
    gateway:          192.168.184.1
    dns_server:       192.168.184.1
  vmware_esxi:
    cpus:             2
    memory:           1024
    data_disk:        4096
    fqdn:             test-ubuntu1804.local
    domain:           local
    ip:               192.168.0.45/24
    gateway:          192.168.0.1
    dns_server:       192.168.0.1
    
- name:               test-ubuntu2004.local
  domain:             local
  type:               ubuntu2004
  ansible_playbook:   ansible/devops.yaml
  ansible_groups:     monitored,prometheus,grafana
  virtualbox:
    cpus:             2
    memory:           1024
    data_disk:        4096
    fqdn:             test-ubuntu2004.local
    domain:           local
    ip:               192.168.184.44/24
    gateway:          192.168.184.1
    dns_server:       192.168.184.1
  vmware_desktop:
    cpus:             2
    memory:           1024
    data_disk:        4096
    fqdn:             test-ubuntu2004.local
    domain:           local
    ip:               192.168.184.44/24
    gateway:          192.168.184.1
    dns_server:       192.168.184.1
  vmware_esxi:
    cpus:             2
    memory:           1024
    data_disk:        4096
    fqdn:             test-ubuntu2004.local
    domain:           local
    ip:               192.168.0.44/24
    gateway:          192.168.0.1
    dns_server:       192.168.0.1    


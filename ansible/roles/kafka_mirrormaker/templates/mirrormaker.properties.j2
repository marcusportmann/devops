# Specify the cluster aliases
clusters = {{ kafka_config.clusters | flatten(1) | join(',') }}

# Connection information for each cluster
# This is a comma separated list of host:port pairs for each cluster
{% for cluster_name in (kafka_config.clusters | flatten(1)) %}
{% set kafka_bootstrap_servers = [] -%}
{% for kafka_server_host in (kafka_config.clusters[cluster_name].kafka_server_hosts | flatten(1) | intersect(groups['kafka_server']|default([]))) %}
{% set _ = kafka_bootstrap_servers.append("%s:%d" % (kafka_server_host, kafka.kafka_mirrormaker.kafka_broker.secure_broker_port)) %}
{% endfor %}
{{ cluster_name }}.bootstrap.servers = {{ kafka_bootstrap_servers | join(',') }}
{{ cluster_name }}.producer.enable.idempotence = true
{% if ('replicate_to_cluster' in kafka_config.clusters[cluster_name]) %}
{{ cluster_name }}->{{ kafka_config.clusters[cluster_name].replicate_to_cluster }}.enabled = true
{% endif %}

{% endfor %}


# Setting replication factor of newly created remote topics
replication.factor=1


############################# Internal Topic Settings  #############################
# The replication factor for mm2 internal topics
# For anything other than development testing, a value greater than 1 is recommended to ensure availability such as 3.
checkpoints.topic.replication.factor=1
heartbeats.topic.replication.factor=1
offset-syncs.topic.replication.factor=1

# The replication factor for connect internal topics
# For anything other than development testing, a value greater than 1 is recommended to ensure availability such as 3.
offset.storage.replication.factor=1
status.storage.replication.factor=1
config.storage.replication.factor=1

# Customize as needed
# replication.policy.separator = _
# emit.heartbeats.interval.seconds = 5


sync.topic.acls.enabled = true
#sync.topic.acls.interval.seconds = 10
sync.topic.configs.enabled = true
#sync.topic.configs.interval.seconds = 10
refresh.topics.enabled = true
#refresh.topics.interval.seconds = 60
refresh.groups.enabled = true
#refresh.groups.interval.seconds = 60


security.protocol=SASL_SSL
ssl.protocol=TLS
ssl.keystore.type=PKCS12
ssl.keystore.location={{ kafka_config.kafka_mirrormaker.etc_directory }}/pki/{{ inventory_hostname_short }}.p12
ssl.keystore.password={{ kafka_mirrormaker_keystore_password }}
ssl.truststore.type=PKCS12
ssl.truststore.location={{ kafka_config.kafka_mirrormaker.etc_directory }}/pki/ca.p12
ssl.truststore.password={{ ca_truststore_password }}
sasl.mechanism=SCRAM-SHA-256
sasl.jaas.config=org.apache.kafka.common.security.scram.ScramLoginModule required username="{{ 'mirrormaker-' + kafka_mirrormaker_user_cluster_name.replace('_', '-') }}" password="{{ kafka_mirrormaker_user_password }}";


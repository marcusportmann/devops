---
# file: roles/kafka_zookeeper/tasks/ubuntu.yaml

- debug:
    msg: Applying the Ubuntu-specific Kafka ZooKeeper configuration

- name: Enable the firewall
  ufw:
    state: enabled
    policy: deny

- name: Allow all access to tcp port 2182 (Secure ZooKeeper Client Port) for Kafka Server hosts
  ufw:
    rule: allow
    source: "{{ hostvars[item]['ansible_default_ipv4']['address'] }}"
    port: '2182'
    proto: tcp
  loop: "{{ groups['kafka_server'] | default([]) }}"
  when: (item != inventory_hostname)

- name: Allow all access to tcp port 2888 to other Kafka ZooKeeper hosts
  ufw:
    rule: allow
    source: "{{ hostvars[item]['ansible_default_ipv4']['address'] }}"
    port: '2888'
    proto: tcp
  loop: "{{ groups['kafka_zookeeper'] }}"
  when: (item != inventory_hostname)

- name: Allow all access to tcp port 3888 to other Kafka ZooKeeper hosts
  ufw:
    rule: allow
    source: "{{ hostvars[item]['ansible_default_ipv4']['address'] }}"
    port: '3888'
    proto: tcp
  loop: "{{ groups['kafka_zookeeper'] }}"
  when: (item != inventory_hostname)

